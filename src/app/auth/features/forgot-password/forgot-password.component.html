<div class="auth-page">
  <div class="auth-card">
    <div class="auth-card__header">
      <h1 class="auth-card__title">Recuperar contraseÃ±a</h1>
    </div>

    <!-- Error del servidor -->
    @if (serverError()) {
      <div class="auth-card__alert auth-card__alert--error" role="alert">
        {{ serverError() }}
      </div>
    }

    <!-- Estado inicial: formulario email -->
    @if (!success()) {
      <p class="auth-card__description">
        Introduce el email asociado a tu cuenta y te enviaremos
        un cÃ³digo de 6 dÃ­gitos para restablecer tu contraseÃ±a.
      </p>

      <form (submit)="onSubmit(); $event.preventDefault()" novalidate>
        <!-- Email -->
        <div class="form-group">
          <label for="fp-email" class="form-group__label">Email</label>
          <input
            id="fp-email"
            type="email"
            class="input"
            autocomplete="email"
            placeholder="tu@email.com"
            [value]="email()"
            (input)="updateEmail($event)"
            (blur)="emailTouched.set(true)"
            [attr.aria-invalid]="emailTouched() && emailError() ? 'true' : null"
            [attr.aria-describedby]="emailTouched() && emailError() ? 'fp-email-error' : null" />
          @if (emailTouched() && emailError()) {
            <span id="fp-email-error" class="form-error" role="alert">
              {{ emailError() }}
            </span>
          }
        </div>

        <button
          type="submit"
          class="btn btn--primary auth-card__submit"
          [disabled]="loading()">
          @if (loading()) {
            <span class="spinner" aria-hidden="true"></span>
            Enviandoâ€¦
          } @else {
            Enviar cÃ³digo OTP
          }
        </button>
      </form>
    }

    <!-- Estado Ã©xito: instrucciones OTP -->
    @if (success()) {
      <div class="otp-sent" role="status">
        <div class="otp-sent__icon" aria-hidden="true">ğŸ“§</div>
        <h2 class="otp-sent__title">CÃ³digo enviado</h2>
        <p class="otp-sent__body">
          Si <strong>{{ email() }}</strong> estÃ¡ registrado en nuestra
          plataforma, recibirÃ¡s un correo con un cÃ³digo de 6 dÃ­gitos.
        </p>

        <ul class="otp-instructions">
          <li>ğŸ•’ El cÃ³digo expira en <strong>15 minutos</strong>.</li>
          <li>ğŸ“¥ Revisa tambiÃ©n tu carpeta de <strong>spam o correo no deseado</strong>.</li>
          <li>ğŸ”¢ El cÃ³digo tiene exactamente <strong>6 dÃ­gitos</strong>.</li>
          <li>ğŸš« MÃ¡ximo <strong>5 intentos</strong> por cÃ³digo.</li>
        </ul>

        <button
          type="button"
          class="btn btn--primary auth-card__submit"
          (click)="goToReset()">
          Ingresar cÃ³digo
        </button>

        <button
          type="button"
          class="btn btn--ghost auth-card__submit--secondary"
          (click)="success.set(false)">
          Usar otro email
        </button>
      </div>
    }

    <nav class="auth-card__links" aria-label="NavegaciÃ³n de autenticaciÃ³n">
      <a routerLink="/auth/login" class="auth-card__link">
        Volver al inicio de sesiÃ³n
      </a>
    </nav>
  </div>
</div>

