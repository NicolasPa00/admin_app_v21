<div class="auth-page">
  <div class="auth-card">
    <div class="auth-card__header">
      <h1 class="auth-card__title">Restablecer contrase√±a</h1>
    </div>

    <!-- Sin token -->
    @if (!token()) {
      <div class="auth-card__alert auth-card__alert--error" role="alert">
        ‚ö†Ô∏è El enlace no es v√°lido. Solicita un nuevo enlace de recuperaci√≥n.
      </div>
    }

    <!-- √âxito -->
    @if (success()) {
      <div class="auth-card__alert auth-card__alert--success" role="status">
        ‚úÖ Tu contrase√±a ha sido restablecida correctamente. Ya puedes iniciar
        sesi√≥n.
      </div>
    }

    <!-- Error del servidor -->
    @if (serverError()) {
      <div class="auth-card__alert auth-card__alert--error" role="alert">
        {{ serverError() }}
      </div>
    }

    @if (token() && !success()) {
      <form (submit)="onSubmit(); $event.preventDefault()" novalidate>
        <!-- Nueva contrase√±a -->
        <div class="form-group">
          <label for="rp-password" class="form-group__label">
            Nueva contrase√±a
          </label>
          <div class="form-group__input-wrapper">
            <input
              id="rp-password"
              [type]="showPassword() ? 'text' : 'password'"
              class="input"
              autocomplete="new-password"
              placeholder="M√≠nimo 8 caracteres"
              [value]="newPassword()"
              (input)="updateField(newPassword, $event)"
              (blur)="newPasswordTouched.set(true)"
              [attr.aria-invalid]="newPasswordTouched() && newPasswordError() ? 'true' : null"
              [attr.aria-describedby]="newPasswordTouched() && newPasswordError() ? 'rp-password-error' : null" />
            <button
              type="button"
              class="form-group__toggle-password"
              (click)="togglePasswordVisibility()"
              [attr.aria-label]="showPassword() ? 'Ocultar contrase√±a' : 'Mostrar contrase√±a'">
              @if (showPassword()) { <span aria-hidden="true">üôà</span> }
              @else { <span aria-hidden="true">üëÅÔ∏è</span> }
            </button>
          </div>
          @if (newPasswordTouched() && newPasswordError()) {
            <span id="rp-password-error" class="form-error" role="alert">
              {{ newPasswordError() }}
            </span>
          }
        </div>

        <!-- Confirmar contrase√±a -->
        <div class="form-group">
          <label for="rp-confirm" class="form-group__label">
            Confirmar contrase√±a
          </label>
          <input
            id="rp-confirm"
            type="password"
            class="input"
            autocomplete="new-password"
            placeholder="Repite la contrase√±a"
            [value]="confirmPassword()"
            (input)="updateField(confirmPassword, $event)"
            (blur)="confirmPasswordTouched.set(true)"
            [attr.aria-invalid]="confirmPasswordTouched() && confirmPasswordError() ? 'true' : null"
            [attr.aria-describedby]="confirmPasswordTouched() && confirmPasswordError() ? 'rp-confirm-error' : null" />
          @if (confirmPasswordTouched() && confirmPasswordError()) {
            <span id="rp-confirm-error" class="form-error" role="alert">
              {{ confirmPasswordError() }}
            </span>
          }
        </div>

        <button
          type="submit"
          class="btn btn--primary auth-card__submit"
          [disabled]="loading()">
          @if (loading()) {
            <span class="spinner" aria-hidden="true"></span>
            Restableciendo‚Ä¶
          } @else {
            Restablecer contrase√±a
          }
        </button>
      </form>
    }

    <nav class="auth-card__links" aria-label="Navegaci√≥n de autenticaci√≥n">
      <a routerLink="/auth/login" class="auth-card__link">
        Ir a iniciar sesi√≥n
      </a>
    </nav>
  </div>
</div>
